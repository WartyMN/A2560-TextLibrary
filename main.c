/*
 * test5.c
 *
 *  Created on: Feb 19, 2022
 *      Author: micahbly
 */


/*****************************************************************************/
/*                                Includes                                   */
/*****************************************************************************/


// project includes
#include "lib_general.h"
#include "lib_general_a2560.h"

#include "lib_text.h"


// C includes
#include <stdio.h>
#include <stdlib.h>
#include <string.h>


// A2560 includes
#include <mcp/syscalls.h>


/*****************************************************************************/
/*                               Definitions                                 */
/*****************************************************************************/

#define RUN_TESTS	1	// define "RUN_TESTS" to include ability to run tests. If undefined, this class will not be aware of tests.

#if defined(RUN_TESTS)
	#include "test_base.h"
#endif


/*****************************************************************************/
/*                             Global Variables                              */
/*****************************************************************************/

unsigned long ditherData = 0x5555AAAA;

Screen	global_screen[2];

/*****************************************************************************/
/*                       Private Function Prototypes                         */
/*****************************************************************************/


/*****************************************************************************/
/*                       Private Function Definitions                        */
/*****************************************************************************/



/*****************************************************************************/
/*                        Public Function Definitions                        */
/*****************************************************************************/

// NOTE: lots of test junk getting put here temporarily until I can figure out why
// minunit and other stuff crashes morfe

boolean font_replace_test2(void);
boolean font_test(void);
boolean keyboard_test(void);

// until file objects available in morfe, need some data to test font replacement.
// this is my C128 lich king font. will need to be remapped to A2560 / code page 437.
boolean font_replace_test2(void)
{
	// Exported using VChar64 v0.2.4
	// Total bytes: 2048
	unsigned char testfont[] = {  
		0x80,0x98,0xa4,0xc4,0xa2,0xa2,0xbc,0xa4,0x00,0x00,0x3d,0x67,0x63,0x67,0x3b,0x00,
		0x60,0x60,0x6e,0x73,0x63,0x73,0x6e,0x00,0x00,0x00,0x3e,0x63,0x60,0x63,0x3e,0x00,
		0x38,0x0c,0x3e,0x67,0x63,0x63,0x3e,0x00,0x00,0x00,0x3e,0x63,0x7f,0x60,0x3f,0x00,
		0x36,0x3b,0x30,0x30,0x7c,0x30,0x30,0x60,0x00,0x00,0x3e,0x63,0x60,0x67,0x3e,0x06,
		0x60,0x60,0x6e,0x73,0x63,0x66,0x6f,0x00,0x06,0x00,0x1c,0x0c,0x0c,0x0c,0x1c,0x00,
		0x06,0x00,0x1c,0x0c,0x0c,0x0c,0x4c,0x38,0x60,0x60,0x66,0x6c,0x78,0x6c,0x67,0x00,
		0x18,0x18,0x18,0x18,0x18,0x1a,0x1e,0x00,0x00,0x00,0x56,0x7f,0x6b,0x63,0x66,0x00,
		0x00,0x00,0x6e,0x73,0x63,0x66,0x6f,0x00,0x00,0x00,0x3e,0x63,0x63,0x63,0x3e,0x00,
		0x00,0x00,0x6e,0x73,0x63,0x73,0x6e,0x60,0x00,0x00,0x3b,0x67,0x63,0x67,0x3b,0x03,
		0x00,0x00,0x6e,0x73,0x63,0x7e,0x63,0x00,0x00,0x00,0x1e,0x30,0x1e,0x47,0x3e,0x00,
		0x0c,0x18,0x7e,0x30,0x30,0x32,0x1c,0x00,0x00,0x00,0x7b,0x33,0x63,0x67,0x3b,0x00,
		0x00,0x00,0x76,0x33,0x63,0x66,0x3c,0x00,0x00,0x00,0x76,0x63,0x6b,0x3e,0x14,0x00,
		0x00,0x00,0x77,0x36,0x1c,0x36,0x77,0x00,0x00,0x00,0x76,0x33,0x1b,0x0e,0x4c,0x38,
		0x00,0x00,0x7f,0x46,0x0c,0x39,0x7f,0x00,0x36,0x7f,0x7f,0x7f,0x3e,0x1c,0x08,0x00,
		0xa2,0x45,0xa2,0x45,0xa2,0x45,0xa2,0x45,0x36,0x49,0x41,0x41,0x22,0x14,0x08,0x00,
		0x3e,0x3e,0x3e,0x3e,0x3e,0x1c,0x18,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x80,0x98,
		0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x18,0x18,0x18,0x18,0x00,0x00,0x18,0x00,
		0x66,0x66,0x66,0x00,0x00,0x00,0x00,0x00,0x66,0x66,0xff,0x66,0xff,0x66,0x66,0x00,
		0x18,0x3e,0x60,0x3c,0x06,0x7c,0x18,0x00,0x62,0x66,0x0c,0x18,0x30,0x66,0x46,0x00,
		0x3c,0x66,0x3c,0x38,0x67,0x66,0x3f,0x00,0x06,0x0c,0x18,0x00,0x00,0x00,0x00,0x00,
		0x0c,0x18,0x30,0x30,0x30,0x18,0x0c,0x00,0x30,0x18,0x0c,0x0c,0x0c,0x18,0x30,0x00,
		0x00,0x66,0x3c,0xff,0x3c,0x66,0x00,0x00,0x14,0x28,0x14,0x28,0x14,0x28,0x14,0x28,
		0x00,0x00,0x00,0x00,0x00,0x18,0x18,0x30,0x00,0x00,0x00,0x7e,0x00,0x00,0x00,0x00,
		0x00,0x00,0x00,0x00,0x00,0x18,0x18,0x00,0x00,0x03,0x06,0x0c,0x18,0x30,0x60,0x00,
		0x1c,0x36,0x63,0x63,0x63,0x36,0x1c,0x00,0x0c,0x1c,0x3c,0x0c,0x0c,0x0c,0x3f,0x00,
		0x3e,0x63,0x73,0x06,0x0c,0x31,0x7f,0x00,0x7f,0x46,0x0c,0x1e,0x03,0x63,0x3e,0x00,
		0x06,0x0e,0x1e,0x36,0x7f,0x06,0x0f,0x00,0x7f,0x60,0x7e,0x63,0x03,0x63,0x3e,0x00,
		0x0e,0x18,0x30,0x7e,0x63,0x63,0x3e,0x00,0x7f,0x46,0x0c,0x18,0x18,0x18,0x18,0x00,
		0x3e,0x63,0x63,0x3e,0x63,0x63,0x3e,0x00,0x3e,0x63,0x63,0x3f,0x06,0x0c,0x38,0x00,
		0x00,0x00,0x18,0x00,0x00,0x18,0x00,0x00,0x00,0x00,0x00,0x00,0x80,0x98,0xa4,0xc4,
		0x08,0x1c,0x3e,0x7f,0x1c,0x1c,0x1c,0x00,0x00,0x00,0x7e,0x00,0x7e,0x00,0x00,0x00,
		0x60,0xf0,0xf6,0xef,0x6f,0x67,0x06,0x06,0x3c,0x66,0x06,0x0c,0x18,0x00,0x18,0x00,
		0x00,0x00,0x00,0xff,0xff,0x00,0x00,0x00,0x1c,0x37,0x63,0x63,0x7f,0x33,0x7b,0x00,
		0x6c,0x76,0x66,0x7e,0x63,0x73,0x7e,0x00,0x1e,0x33,0x60,0x60,0x60,0x33,0x1e,0x00,
		0x6c,0x76,0x63,0x63,0x63,0x76,0x6c,0x00,0x6e,0x73,0x30,0x3e,0x30,0x73,0x6e,0x00,
		0x7f,0x31,0x30,0x3e,0x30,0x30,0x70,0x00,0x1e,0x33,0x60,0x67,0x62,0x76,0x3c,0x00,
		0x66,0x63,0x63,0x7f,0x63,0x63,0x33,0x00,0x3f,0x0c,0x0c,0x0c,0x0c,0x0c,0x3f,0x00,
		0x7f,0x46,0x06,0x06,0x06,0x66,0x3c,0x00,0x63,0x66,0x6c,0x78,0x6c,0x66,0x73,0x00,
		0x70,0x60,0x60,0x60,0x60,0x61,0x7f,0x00,0x33,0x7f,0x6b,0x6b,0x63,0x73,0x33,0x00,
		0x66,0x73,0x73,0x6b,0x67,0x67,0x33,0x00,0x1c,0x36,0x63,0x63,0x63,0x36,0x1c,0x00,
		0x6e,0x73,0x63,0x63,0x7e,0x60,0x60,0x00,0x1c,0x36,0x63,0x63,0x6b,0x36,0x1d,0x00,
		0x6e,0x73,0x63,0x63,0x7e,0x66,0x63,0x00,0x1e,0x33,0x31,0x1e,0x03,0x63,0x3e,0x00,
		0x7f,0x59,0x18,0x18,0x18,0x18,0x18,0x00,0x73,0x33,0x63,0x63,0x63,0x63,0x3e,0x00,
		0x73,0x33,0x63,0x63,0x66,0x3c,0x18,0x00,0x76,0x33,0x63,0x63,0x6b,0x6b,0x36,0x00,
		0x77,0x63,0x36,0x1c,0x36,0x63,0x77,0x00,0x77,0x63,0x36,0x1c,0x18,0x18,0x18,0x00,
		0x3f,0x46,0x0c,0x18,0x30,0x61,0x7f,0x00,0x08,0x1c,0x36,0x63,0x36,0x1c,0x08,0x00,
		0xa0,0x50,0xa0,0x50,0xa0,0x50,0xa0,0x50,0x18,0x18,0x18,0x18,0x18,0x18,0x18,0x18,
		0x00,0x00,0x00,0x80,0x98,0xa4,0xc4,0xa2,0xff,0x7f,0x3f,0x1f,0x0f,0x07,0x03,0x01,
		0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xf0,0xf0,0xf0,0xf0,0xf0,0xf0,0xf0,0xf0,
		0x00,0x00,0x00,0x00,0xff,0xff,0xff,0xff,0xff,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
		0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xff,0xc0,0xc0,0xc0,0xc0,0xc0,0xc0,0xc0,0xc0,
		0xaa,0x55,0xaa,0x55,0xaa,0x55,0xaa,0x55,0x03,0x03,0x03,0x03,0x03,0x03,0x03,0x03,
		0x00,0x00,0x00,0x00,0x55,0xaa,0x55,0xaa,0xff,0xfe,0xfc,0xf8,0xf0,0xe0,0xc0,0x80,
		0x03,0x03,0x03,0x03,0x03,0x03,0x03,0x03,0x18,0x18,0x18,0x1f,0x1f,0x18,0x18,0x18,
		0x00,0x00,0x00,0x00,0x0f,0x0f,0x0f,0x0f,0x18,0x18,0x18,0x1f,0x1f,0x00,0x00,0x00,
		0x00,0x00,0x00,0xf8,0xf8,0x18,0x18,0x18,0x00,0x00,0x00,0x00,0x00,0x00,0xff,0xff,
		0x00,0x00,0x00,0x1f,0x1f,0x18,0x18,0x18,0x18,0x18,0x18,0xff,0xff,0x00,0x00,0x00,
		0x00,0x00,0x00,0xff,0xff,0x18,0x18,0x18,0x18,0x18,0x18,0xf8,0xf8,0x18,0x18,0x18,
		0xc0,0xc0,0xc0,0xc0,0xc0,0xc0,0xc0,0xc0,0xe0,0xe0,0xe0,0xe0,0xe0,0xe0,0xe0,0xe0,
		0x07,0x07,0x07,0x07,0x07,0x07,0x07,0x07,0xff,0xff,0x00,0x00,0x00,0x00,0x00,0x00,
		0xff,0xff,0xff,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xff,0xff,0xff,
		0x18,0x18,0x18,0xff,0xff,0x18,0x18,0x18,0x00,0x00,0x00,0x00,0xf0,0xf0,0xf0,0xf0,
		0x0f,0x0f,0x0f,0x0f,0x00,0x00,0x00,0x00,0x18,0x18,0x18,0xf8,0xf8,0x00,0x00,0x00,
		0xf0,0xf0,0xf0,0xf0,0x00,0x00,0x00,0x00,0xf0,0xf0,0xf0,0xf0,0x0f,0x0f,0x0f,0x0f,
		0x7e,0x9d,0xd1,0xcd,0xdd,0x8e,0x34,0x7b,0x00,0xb6,0xbb,0xbb,0x83,0x38,0xdd,0xe1,
		0xec,0xce,0x36,0x78,0xb6,0xee,0xde,0x5c,0x00,0x00,0xd8,0xdc,0xdc,0xc0,0x3c,0x38,
		0xdf,0xee,0xec,0x83,0xbb,0xbb,0x77,0x00,0x00,0xb6,0xbb,0x81,0xbb,0xbb,0x77,0x00,
		0x3e,0x1e,0xc0,0xdc,0xde,0xce,0x00,0x00,0x00,0xb0,0xbc,0xe0,0xdc,0xbc,0x1c,0x00,
		0x3a,0x5b,0x67,0x6d,0x1e,0x6c,0x73,0x3f,0x00,0x00,0x38,0x7b,0x7b,0x03,0x7c,0x7c,
		0x3e,0x00,0x3c,0x3e,0x00,0x1e,0x1e,0x00,0x00,0x18,0x3c,0x00,0x3e,0x3c,0x00,0x3e,
		0x3c,0x38,0x03,0x1b,0x3b,0x1b,0x00,0x00,0x00,0x00,0x3d,0x01,0x39,0x3d,0x00,0x00,
		0x3e,0x00,0x3c,0x3e,0x00,0x3e,0x1e,0x00,0x00,0x1e,0x6e,0x6c,0x60,0x1e,0x3e,0x00,
		0x6e,0x6e,0x6e,0x6e,0x6e,0x2c,0x10,0x00,0x2a,0x54,0x2a,0x54,0x2a,0x54,0x2a,0x54,
		0x00,0x00,0x00,0x00,0x00,0x80,0x98,0xa4,0x10,0x00,0x24,0x1a,0x58,0x04,0x10,0x00,
		0x86,0x68,0x23,0x34,0x58,0x8d,0x46,0x4a,0x44,0x2c,0x18,0xf4,0x1a,0x51,0xa8,0x04,
		0x21,0x52,0x2c,0x14,0x66,0x88,0x54,0xa2,0x1a,0xa2,0xaa,0x95,0x08,0x76,0x90,0x2b,
		0x06,0x81,0x11,0x02,0xd4,0x00,0x90,0x50,0x11,0x08,0x00,0x22,0x10,0x00,0x00,0x02,
		0x00,0x00,0x00,0x10,0x10,0x00,0x00,0x00,0x3f,0x3f,0x3f,0x3f,0x3f,0x3f,0x00,0x00,
		0x36,0x49,0x7f,0x7f,0x3e,0x1c,0x08,0x00,0x76,0x76,0x76,0x76,0x76,0x34,0x08,0x00,
		0x7c,0x7c,0x7c,0x7c,0x7c,0x38,0x18,0x00,0x00,0x00,0x10,0x08,0x10,0x08,0x00,0x00,
		0xff,0xdf,0xff,0xfb,0xff,0xbf,0xff,0xfd,0x00,0x93,0xf7,0xff,0xfb,0xff,0xdf,0xff,
		0xfe,0xf6,0xfc,0xfc,0xf8,0xfc,0xbe,0xfe,0x00,0x90,0xfc,0xb8,0xf8,0xfc,0xdc,0xfe,
		0xff,0xdf,0xff,0xfb,0xff,0xf7,0x93,0x00,0x00,0x9d,0xef,0xfb,0xff,0xf7,0x93,0x00,
		0xfe,0xdc,0xfc,0xf8,0xb8,0xfc,0x90,0x00,0x00,0xb4,0xbc,0xfe,0x7e,0xf4,0x98,0x00,
		0x7f,0x7f,0x3d,0x7f,0x1f,0x37,0x7f,0x7f,0x00,0x19,0x3f,0x7d,0x2f,0x3f,0x7f,0x7f,
		0x7e,0x36,0x3c,0x7c,0x78,0x1c,0x3e,0x7e,0x00,0x18,0x7c,0x3a,0x7e,0x7c,0x1c,0x76,
		0x7f,0x7f,0x3f,0x2f,0x7d,0x3f,0x19,0x00,0x00,0x2d,0x3d,0x7f,0x7e,0x2f,0x19,0x00,
		0x76,0x1c,0x7c,0x7e,0x3a,0x7c,0x18,0x00,0x00,0x1c,0x7e,0x3a,0x6e,0x3e,0x34,0x00,
		0x00,0x3c,0x7e,0x7e,0x7e,0x7e,0x3c,0x00,0x00,0x00,0x00,0x00,0x00,0xff,0xff,0x00,
		0x77,0xff,0xdd,0xff,0x77,0xff,0xdd,0xff,0x00,0x00,0x00,0x04,0x0a,0x2a,0x59,0xff,
		0x00,0x20,0x50,0x56,0x4a,0xa2,0xb2,0xff,0x00,0x00,0x04,0x0a,0x2a,0x52,0x49,0xff,
		0x10,0x28,0x2a,0x45,0x55,0x69,0x45,0xff,0x00,0x40,0xa8,0x94,0xd4,0xa2,0x91,0xff,
		0x36,0x49,0x41,0x41,0x3e,0x1c,0x08,0x00,0x00,0x00,0x10,0x30,0x18,0x10,0x00,0x00,
		0x3c,0x6a,0x7d,0x3e,0x7d,0x63,0x3c,0x00,0x00,0x10,0x18,0x24,0x66,0x18,0x10,0x00,
		0x10,0x00,0x24,0x1a,0x58,0x04,0x10,0x00,0x34,0x42,0x51,0x08,0x4d,0x41,0x34,0x00,
		0x66,0x81,0xbd,0x00,0x24,0x95,0x81,0x66,0x00,0x44,0x02,0x00,0x00,0x40,0x22,0x01,
		0xff,0xff,0xff,0x00,0x00,0xff,0xff,0xff,0x08,0x10,0x08,0x10,0x08,0x10,0x08,0x10,
		0x00,0x00,0x80,0x98,0xa4,0xc4,0xa2,0xa2,0x00,0x80,0x98,0xa4,0xc4,0xa2,0xa2,0xa4,
		0x40,0xe0,0xff,0x7f,0xff,0xe0,0x40,0x00,0x02,0x07,0xff,0xfe,0xff,0x07,0x02,0x00,
		0x6c,0xfe,0x7c,0x38,0x38,0x7c,0xfe,0x6c,0x36,0x49,0x41,0x41,0x22,0x1c,0x08,0x00,
		0x7f,0xf7,0xe3,0xf7,0x7e,0x1e,0x1f,0x0a,0xfc,0xde,0x8e,0xde,0xfc,0xf0,0xf0,0xa0,
		0x03,0x05,0x0a,0x54,0x68,0x30,0x58,0x80,0x01,0x12,0x0d,0x09,0x12,0x2c,0x40,0x80,
		0x10,0x2c,0x46,0x22,0x31,0x5a,0xa4,0x40,0x00,0x0c,0x14,0x68,0x30,0x50,0x80,0x00,
		0xc0,0x9d,0x22,0x54,0x48,0x54,0x20,0x40,0x02,0x07,0x0e,0x1c,0x38,0x70,0xe0,0x40,
		0x06,0x12,0x08,0x14,0x20,0x40,0x80,0x00,0x00,0x18,0x24,0x42,0x22,0x4c,0x90,0x20,
		0x00,0x00,0x00,0x18,0x2e,0x7f,0xdb,0x00,0x18,0x3c,0x66,0x66,0x3c,0x18,0x3c,0x00,
		0x7e,0x7e,0x7e,0x7e,0x7e,0x3c,0x18,0x00,0x7c,0xc6,0xba,0xf6,0xee,0xfe,0x6c,0x00,
		0x00,0x0e,0x1c,0x38,0x3c,0x18,0x30,0x60,0x04,0x10,0x01,0x18,0x3a,0x70,0xe0,0xc0,
		0x3c,0x24,0x24,0x42,0xff,0xff,0x7e,0x00,0x00,0x00,0x00,0x08,0x00,0x00,0x00,0x00,
		0x3c,0x7e,0xff,0xff,0x9f,0xff,0xff,0xff,0xc0,0xc0,0xf0,0xf0,0xfc,0xfc,0xff,0xff,
		0x00,0x4c,0x3e,0x1e,0x7e,0x1e,0x1e,0x12,0x80,0x98,0xbc,0xfc,0xbe,0xbe,0xbc,0xa4,
		0x01,0x19,0x3d,0x3f,0x7d,0x7d,0x3d,0x25,0x00,0x80,0xc0,0xe0,0xf0,0xf8,0xfc,0xfe,
		0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0x0f,0x0f,0x0f,0x0f,0x0f,0x0f,0x0f,0x0f,
		0xff,0xff,0xff,0xff,0x00,0x00,0x00,0x00,0x00,0xff,0xff,0xff,0xff,0xff,0xff,0xff,
		0xff,0xff,0xff,0xff,0xff,0xff,0xff,0x00,0x3f,0x3f,0x3f,0x3f,0x3f,0x3f,0x3f,0x3f,
		0xaa,0x00,0xaa,0x00,0xaa,0x00,0xaa,0x00,0xfc,0xfc,0xfc,0xfc,0xfc,0xfc,0xfc,0xfc,
		0x5e,0x5e,0x5e,0x5e,0x5e,0x2c,0x18,0x00,0x00,0x01,0x03,0x07,0x0f,0x1f,0x3f,0x7f,
		0x7a,0x7a,0x7a,0x7a,0x7a,0x34,0x18,0x00,0xe7,0xe7,0xe7,0xe0,0xe0,0xe7,0xe7,0xe7,
		0xff,0xff,0xff,0xff,0xf0,0xf0,0xf0,0xf0,0x0e,0x1f,0x1f,0x1f,0x0f,0x07,0x03,0x00,
		0x70,0xf8,0xf8,0xf8,0xf0,0xe0,0xc0,0x00,0x40,0x70,0x7f,0x76,0x70,0x7a,0x3d,0x1f,
		0x02,0x0e,0xfe,0x6e,0x0e,0x5e,0xbc,0xf8,0x36,0x49,0x41,0x7f,0x3e,0x1c,0x08,0x00,
		0x88,0x00,0x22,0x00,0x88,0x00,0x22,0x00,0x38,0x7c,0x7c,0xba,0x92,0x6c,0x54,0x00,
		0x82,0x41,0x82,0x41,0x82,0x41,0x82,0x41,0x1f,0x1f,0x1f,0x1f,0x1f,0x1f,0x1f,0x1f,
		0xf8,0xf8,0xf8,0xf8,0xf8,0xf8,0xf8,0xf8,0x00,0x00,0xff,0xff,0xff,0xff,0xff,0xff,
		0x00,0x00,0x00,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0x00,0x00,0x00,
		0x34,0x6a,0x55,0x0c,0x5d,0x63,0x34,0x00,0xff,0xff,0xff,0xff,0x0f,0x0f,0x0f,0x0f,
		0xf0,0xf0,0xf0,0xf0,0xff,0xff,0xff,0xff,0x80,0x01,0x80,0x01,0x80,0x01,0x80,0x01,
		0x0f,0x0f,0x0f,0x0f,0xff,0xff,0xff,0xff,0x0f,0x0f,0x0f,0x0f,0xf0,0xf0,0xf0,0xf0,
	};
	
	unsigned char*	the_new_font_data = testfont;
	
	if ( Text_UpdateFontData(ID_CHANNEL_A, the_new_font_data))
	{
		return false;
	}

	return true;
}


boolean font_test(void)
{
	// alloc a block of memory for overwriting font data
	// need 256 chars * 8 bytes each
	
	char*	the_new_font_data;
	
	if ( (the_new_font_data = (char*)calloc(256 * 8, sizeof(char)) ) == NULL)
	{
		return false;
	}

	//DEBUG_OUT(("%s %d: font data chunk allocated ok", __func__, __LINE__));
	
	free(the_new_font_data);
	
	return true;
	//Text_ShowFontChars(ID_CHANNEL_B);
	//Text_UpdateFontData(ID_CHANNEL_B, (char*)0x000000);
}


boolean keyboard_test(void)
{
	signed short			bytes_read = 0;
	signed short			bytes_requested = 5;
	static unsigned char	keyboard_buff[256];
	unsigned char*			the_keyboard_buff = keyboard_buff;
	signed short			the_channel_id;
	signed short			the_device_id = 0;
	boolean					stop = false;
	signed int				y = 30;
	
	Text_DrawStringAtXY(ID_CHANNEL_A, 0, y++, (char*)"Trying to open keyboard device...", FG_COLOR_DK_BLUE, BG_COLOR_YELLOW);
	
	// open keyboard console for reading. Console is on device 0 and 1. 
	the_channel_id = sys_chan_open(the_device_id, (unsigned char*)"", 1);
	
	if (the_channel_id < 0)
	{
		//DEBUG_OUT(("%s %d: Failed to open channel for device %i. Error# %i", __func__, __LINE__, the_device_id, the_channel_id));
		Text_DrawStringAtXY(ID_CHANNEL_A, 0, y++, (char*)"Failed to open keyboard device", FG_COLOR_DK_BLUE, BG_COLOR_YELLOW);
		return false;
	}
	else
	{
		Text_DrawStringAtXY(ID_CHANNEL_A, 0, y++, (char*)"Opened keyboard device", FG_COLOR_DK_BLUE, BG_COLOR_YELLOW);
	}
	
	sys_chan_flush(the_channel_id);
	
	Text_DrawStringAtXY(ID_CHANNEL_A, 0, y++, (char*)"flushed channel", FG_COLOR_DK_BLUE, BG_COLOR_YELLOW);

	if ( ((sys_chan_status(the_channel_id) & CDEV_STAT_ERROR) == 1) )
	{
		Text_DrawStringAtXY(ID_CHANNEL_A, 0, y++, (char*)"channel status had error (0x01)", FG_COLOR_DK_BLUE, BG_COLOR_YELLOW);
		return false;
	}
	else
	{
		Text_DrawStringAtXY(ID_CHANNEL_A, 0, y++, (char*)"channel status says no error condition", FG_COLOR_DK_BLUE, BG_COLOR_YELLOW);
	}
	
	// read and type characters to screen until there is an channel error, or the char typed is tab
	while ( ((sys_chan_status(the_channel_id) & CDEV_STAT_ERROR) == 0) && !stop)
	{
		unsigned char	the_char;
		
		//bytes_read = sys_chan_read(the_channel_id, the_keyboard_buff, bytes_requested);
		the_char = sys_chan_read_b(the_channel_id);
		bytes_read++;
		
		if (the_char == '\t')
		{
			stop = true;
		}
		else
		{
			Text_SetCharAtXY(ID_CHANNEL_A, bytes_read, 40, the_char);
		}
		
		//Text_DrawStringAtXY(ID_CHANNEL_A, 0, 40, (char*)the_keyboard_buff, FG_COLOR_DK_BLUE, BG_COLOR_YELLOW);
	}

	// close channel
	sys_chan_close(the_channel_id);
		
	return true;
}


int main(int argc, char* argv[])
{

#define __f68 1	// undefine '__f68' if running in morfe or addresses will be wrong for morfe

	// move to startup function
	global_screen[ID_CHANNEL_A].id_ = ID_CHANNEL_A;
	global_screen[ID_CHANNEL_A].text_temp_buffer_1_[0] = '\0';
	global_screen[ID_CHANNEL_A].text_temp_buffer_2_[0] = '\0';
	global_screen[ID_CHANNEL_A].text_font_width_ = TEXT_FONT_WIDTH_A2650;
	global_screen[ID_CHANNEL_A].text_font_height_ = TEXT_FONT_HEIGHT_A2650;
	global_screen[ID_CHANNEL_A].rect_.MinX = 0;
	global_screen[ID_CHANNEL_A].rect_.MinY = 0;
	
	#ifdef __f68
		global_screen[ID_CHANNEL_A].width_ = 800;	
		global_screen[ID_CHANNEL_A].height_ = 600;
		global_screen[ID_CHANNEL_A].text_ram_ = TEXTA_RAM_A2560K;
		global_screen[ID_CHANNEL_A].text_attr_ram_ = TEXTA_ATTR_A2560K;
		global_screen[ID_CHANNEL_A].text_font0_ram_ = FONT_MEMORY_BANK0_A2560K;
		global_screen[ID_CHANNEL_A].text_font1_ram_ = FONT_MEMORY_BANK0_A2560K;
		global_screen[ID_CHANNEL_A].text_mem_cols_ = global_screen[ID_CHANNEL_A].width_ / global_screen[ID_CHANNEL_A].text_font_width_;
		global_screen[ID_CHANNEL_A].text_mem_rows_ = global_screen[ID_CHANNEL_A].height_ / global_screen[ID_CHANNEL_A].text_font_height_;
		global_screen[ID_CHANNEL_A].text_cols_vis_ = global_screen[ID_CHANNEL_A].text_mem_cols_ - 8; // how morfe has it defined. just guessing for f68
		global_screen[ID_CHANNEL_A].text_rows_vis_ = global_screen[ID_CHANNEL_A].text_mem_rows_ - 4; // how morfe has it defined. just guessing for f68
	#else
		global_screen[ID_CHANNEL_A].width_ = 640;	
		global_screen[ID_CHANNEL_A].height_ = 480;	
		global_screen[ID_CHANNEL_A].text_ram_ = TEXTA_RAM_A2560_MORFE;
		global_screen[ID_CHANNEL_A].text_attr_ram_ = TEXTA_ATTR_A2560_MORFE;
		global_screen[ID_CHANNEL_A].text_font0_ram_ = FONT_MEMORY_BANK0_A2560_MORFE;
		global_screen[ID_CHANNEL_A].text_font1_ram_ = FONT_MEMORY_BANK0_A2560_MORFE;	
		global_screen[ID_CHANNEL_A].text_mem_cols_ = global_screen[ID_CHANNEL_A].width_ / global_screen[ID_CHANNEL_A].text_font_width_;
		global_screen[ID_CHANNEL_A].text_mem_rows_ = global_screen[ID_CHANNEL_A].height_ / global_screen[ID_CHANNEL_A].text_font_height_;
		global_screen[ID_CHANNEL_A].text_cols_vis_ = global_screen[ID_CHANNEL_A].text_mem_cols_ - 8; // how morfe has it defined
		global_screen[ID_CHANNEL_A].text_rows_vis_ = global_screen[ID_CHANNEL_A].text_mem_rows_ - 4; // how morfe has it defined
	#endif	

	global_screen[ID_CHANNEL_A].rect_.MaxX = global_screen[ID_CHANNEL_A].width_;
	global_screen[ID_CHANNEL_A].rect_.MaxY = global_screen[ID_CHANNEL_A].height_;	

	global_screen[ID_CHANNEL_B].id_ = ID_CHANNEL_B;
	global_screen[ID_CHANNEL_B].text_temp_buffer_1_[0] = '\0';
	global_screen[ID_CHANNEL_B].text_temp_buffer_2_[0] = '\0';
	global_screen[ID_CHANNEL_B].text_font_width_ = TEXT_FONT_WIDTH_A2650;
	global_screen[ID_CHANNEL_B].text_font_height_ = TEXT_FONT_HEIGHT_A2650;
	global_screen[ID_CHANNEL_B].rect_.MinX = 0;
	global_screen[ID_CHANNEL_B].rect_.MinY = 0;
	
	#ifdef __f68
		global_screen[ID_CHANNEL_B].width_ = 640;	
		global_screen[ID_CHANNEL_B].height_ = 480;	
		global_screen[ID_CHANNEL_B].text_ram_ = TEXTB_RAM_A2560K;
		global_screen[ID_CHANNEL_B].text_attr_ram_ = TEXTB_ATTR_A2560K;
		global_screen[ID_CHANNEL_B].text_font0_ram_ = FONT_MEMORY_BANK0_A2560K;
		global_screen[ID_CHANNEL_B].text_font1_ram_ = FONT_MEMORY_BANK0_A2560K;
		global_screen[ID_CHANNEL_B].text_mem_cols_ = global_screen[ID_CHANNEL_B].width_ / global_screen[ID_CHANNEL_B].text_font_width_;
		global_screen[ID_CHANNEL_B].text_mem_rows_ = global_screen[ID_CHANNEL_B].height_ / global_screen[ID_CHANNEL_B].text_font_height_;
		global_screen[ID_CHANNEL_B].text_cols_vis_ = global_screen[ID_CHANNEL_B].text_mem_cols_ - 0; // how morfe has it defined. just guessing for f68
		global_screen[ID_CHANNEL_B].text_rows_vis_ = global_screen[ID_CHANNEL_B].text_mem_rows_ - 0; // how morfe has it defined. just guessing for f68
	#else
		global_screen[ID_CHANNEL_B].width_ = 640;	
		global_screen[ID_CHANNEL_B].height_ = 480;	
		global_screen[ID_CHANNEL_B].text_ram_ = TEXTB_RAM_A2560_MORFE;
		global_screen[ID_CHANNEL_B].text_attr_ram_ = TEXTB_ATTR_A2560_MORFE;
		global_screen[ID_CHANNEL_B].text_font0_ram_ = FONT_MEMORY_BANK0_A2560_MORFE;
		global_screen[ID_CHANNEL_B].text_font1_ram_ = FONT_MEMORY_BANK0_A2560_MORFE;	
		global_screen[ID_CHANNEL_B].text_mem_cols_ = global_screen[ID_CHANNEL_B].width_ / global_screen[ID_CHANNEL_B].text_font_width_;
		global_screen[ID_CHANNEL_B].text_mem_rows_ = global_screen[ID_CHANNEL_B].height_ / global_screen[ID_CHANNEL_B].text_font_height_;
		global_screen[ID_CHANNEL_B].text_cols_vis_ = global_screen[ID_CHANNEL_B].text_mem_cols_ - 0; // how morfe has it defined
		global_screen[ID_CHANNEL_B].text_rows_vis_ = global_screen[ID_CHANNEL_B].text_mem_rows_ - 0; // how morfe has it defined
	#endif	

	//General_LogInitialize();

	//printf("is this thing on?");
	
	//	keyboard_test();

	font_replace_test2();
	
#if defined(RUN_TESTS)
  	Text_RunTests();
#endif

	
}